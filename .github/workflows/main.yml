name: CI

on: [push, pull_request, workflow_dispatch]

jobs:
  binutils-gdb-linux:
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v3
      - run: ci/install-packages-linux.sh
      - run: ci/binutils-gdb/clone.sh
      - run: ci/binutils-gdb/download-prerequisites.sh
      - run: ci/binutils-gdb/configure-linux.sh
      - run: ci/binutils-gdb/build-linux.sh
      - run: ci/binutils-gdb/install.sh
      - run: ci/clean-up-linux.sh
      - uses: actions/upload-artifact@v3
        with:
          name: binutils-gdb-linux
          path: output/

  gcc-linux:
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v3
      - run: ci/install-packages-linux.sh
      - run: ci/gcc/download.sh
      - run: ci/gcc/patch.sh
      - run: ci/gcc/download-prerequisites.sh
      - run: ci/gcc/configure-linux.sh
      - run: ci/gcc/build-linux.sh
      - run: ci/gcc/install.sh
      - run: ci/clean-up-linux.sh
      - uses: actions/upload-artifact@v3
        with:
          name: gcc-linux
          path: output/

  elf2hunk-linux:
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v3
      - run: ci/elf2hunk/clone.sh
      - run: ci/elf2hunk/build.sh
      - uses: actions/upload-artifact@v3
        with:
          name: elf2hunk-linux
          path: elf2hunk/elf2hunk
